# .env.example
# Example environment variables for the Nifty Scalper Bot.
# Copy this file to .env and fill in your actual values.

# -----------------------------------------------------------------------------
# API Credentials (Required)
# -----------------------------------------------------------------------------
KITE_API_KEY=
KITE_API_SECRET=
KITE_ACCESS_TOKEN=

# -----------------------------------------------------------------------------
# Telegram Notifications (Required)
# -----------------------------------------------------------------------------
TELEGRAM__ENABLED=true
TELEGRAM__BOT_TOKEN=
TELEGRAM__CHAT_ID=

# -----------------------------------------------------------------------------
# Application Mode / Logging
# -----------------------------------------------------------------------------
# Set to false to run in paper trading mode
ENABLE_LIVE_TRADING=true
ALLOW_OFFHOURS_TESTING=true
LOG_LEVEL=INFO
LOG_FORMAT=logfmt                 # or: json
TZ="Asia/Kolkata"
ATR_LOG_INTERVAL_S=10              # seconds between ATR info logs when unchanged
# Optional: keep INFO clean by relying on /trace for detailed logs
HEARTBEAT_INTERVAL_SEC=30          # heartbeat log cadence in seconds
PLAN_LOG_INTERVAL_SEC=60           # periodic plan debug log cadence when unchanged
BLOCK_SUMMARY_INTERVAL_SEC=30      # throttle for repeated block reason summaries
DECISION_INTERVAL_SEC=10           # repeated decision log cadence when unchanged
LOG_DECISION_THROTTLE_S=10         # alias for decision log throttle
LOG_SUPPRESS_WINDOW_SEC=300        # seconds to suppress repeated warn/error bursts

# -----------------------------------------------------------------------------
# Trading Window (IST, HH:MM)
# -----------------------------------------------------------------------------
DATA__TIME_FILTER_START=09:20
DATA__TIME_FILTER_END=15:25

# -----------------------------------------------------------------------------
# Data / Warmup
# -----------------------------------------------------------------------------
WARMUP_BARS=15
# Longer startup history avoids off-by-one misses when you launch mid-minute
DATA__LOOKBACK_MINUTES=240
HISTORICAL_TIMEFRAME=minute
QUOTES__MODE=FULL
QUOTES__PRIME_TIMEOUT_MS=2000
QUOTES__RETRY_ATTEMPTS=3
HIST_WARN_RATELIMIT_S=300          # rate-limit repeated broker history warnings

# -----------------------------------------------------------------------------
# Strategy Tuning
# -----------------------------------------------------------------------------
STRATEGY__MIN_SIGNAL_SCORE=5.0
STRATEGY__CONFIDENCE_THRESHOLD=6.0
STRATEGY__MIN_BARS_FOR_SIGNAL=20
STRATEGY__EMA_FAST=9
STRATEGY__EMA_SLOW=21
STRATEGY__RSI_PERIOD=14
STRATEGY__BB_PERIOD=20
STRATEGY__BB_STD=2.0
STRATEGY__ATR_PERIOD=14
STRATEGY__ATR_SL_MULTIPLIER=1.5
STRATEGY__ATR_TP_MULTIPLIER=3.0
STRATEGY__RR_MIN=1.30

# External strategy configuration
STRATEGY_CONFIG_FILE=config/strategy.yaml

# Underlying & strikes
INSTRUMENTS__SPOT_SYMBOL="NSE:NIFTY 50"
INSTRUMENTS__STRIKE_RANGE=3
INSTRUMENTS_REFRESH_MINUTES=15      # refresh broker instrument dump every N minutes
WEEKLY_EXPIRY_WEEKDAY=2             # ISO weekday (1=Mon..7=Sun) for weekly expiry scan
PREFER_MONTHLY_EXPIRY=false         # prefer the monthly expiry when it lands on that weekday

# -----------------------------------------------------------------------------
# Microstructure / freshness
# -----------------------------------------------------------------------------
ALLOW_NO_DEPTH=false
TICK_STALE_SECONDS=5
DEPTH_MIN_QTY=200
SPREAD_MAX_PCT=0.35
MICRO_QUOTE_WARMUP_MS=1200
MICRO_QUOTE_POLL_MS=120
MICRO_OK_HYSTERESIS_MS=2000
MICRO_GRACE_MS=2500
MICRO_MIN_OK_STREAK=2
MICRO__STALE_MS=3500
FRESH_TICK_MAX_AGE_MS=3000
QUOTE_TTL_S=2.5
QUOTE_OK_GRACE_S=2
TICK_WATCHDOG_MS=180000
ORDER_MAX_QUOTE_AGE_MS=3500
ORDER_MAX_SPREAD_PCT=0.35
ORDER_MICRO_RETRIES=3
ORDER_MICRO_RETRY_MS=120
QUOTE_WARMUP_TRIES=1               # attempts to fetch ATM quotes before blocking
QUOTE_WARMUP_SLEEP_MS=0            # delay between warmup attempts (milliseconds)

# -----------------------------------------------------------------------------
# Risk Management
# -----------------------------------------------------------------------------
RISK__MAX_DAILY_DRAWDOWN_PCT=0.03
RISK__MAX_TRADES_PER_DAY=15
RISK__CONSECUTIVE_LOSS_LIMIT=3
RISK__RISK_PER_TRADE=0.01
RISK__MAX_POSITION_SIZE_PCT=0.02
# Enable to override exposure cap with a single lot when cash covers the premium
RISK__ALLOW_MIN_ONE_LOT=true
RISK__EXPOSURE_CAP_PCT=2.0
INSTRUMENTS__MIN_LOTS=1
INSTRUMENTS__MAX_LOTS=10

# Exposure / risk
EXPOSURE_BASIS=premium
RISK_USE_LIVE_EQUITY=true
RISK_DEFAULT_EQUITY=40000
# Session cut-offs (IST, HH:MM)
RISK__NO_NEW_AFTER_HHMM=15:20     # block new entries at/after this time (leave blank to disable)
RISK__EOD_FLATTEN_HHMM=15:28      # force-close positions at/after this time

# -----------------------------------------------------------------------------
# Execution (optional)
# -----------------------------------------------------------------------------
INSTRUMENTS__TRADE_SYMBOL="NIFTY"
INSTRUMENTS__TRADE_EXCHANGE="NFO"
INSTRUMENTS__INSTRUMENT_TOKEN=256265
EXECUTOR__EXCHANGE_FREEZE_QTY=1800
EXECUTOR__TICK_SIZE=0.05
EXECUTOR__REQUIRE_DEPTH=true
EXECUTOR__DEPTH_MULTIPLIER=3.0
EXECUTOR__DEPTH_MIN_LOTS=3
EXECUTOR__MAX_SPREAD_PCT=0.0035

# -----------------------------------------------------------------------------
# Monitoring / System
# -----------------------------------------------------------------------------
SYSTEM__LOG_BUFFER_CAPACITY=4000
# Health server (optional)
HEALTH_HOST=0.0.0.0
HEALTH_PORT=8000
# Legacy tuning knobs
DIAG_INTERVAL_SECONDS=60
MIN_PREVIEW_SCORE=8
ACK_TIMEOUT_MS=1500
FILL_TIMEOUT_MS=10000
RETRY_BACKOFF_MS=200
MAX_PLACE_RETRIES=2
MAX_MODIFY_RETRIES=2
PLAN_STALE_SEC=20

