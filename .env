9# --- Zerodha ---
ZERODHA_API_KEY=9a6h8ko5o1myv0hp
ZERODHA_API_SECRET=9yuor4cxqou1a9t3hkh4wsg1oz64hbsg
# Prefer this:
KITE_ACCESS_TOKEN=tw3q8PLdup1gfSDkTAWe5qzMD3b88mo3
# (legacy) If you still have old setups:
ZERODHA_ACCESS_TOKEN=tw3q8PLdup1gfSDkTAWe5qzMD3b88mo3

# --- Telegram ---
TELEGRAM_BOT_TOKEN=7962917167:AAGyIOqZJLq-TKz-ozZODcDT4syeVWFIybU
TELEGRAM_CHAT_ID=6931456598

# =========================
# MODES / TOGGLES
# =========================
ENABLE_LIVE_TRADING=true
ENABLE_TELEGRAM=true
ALLOW_OFFHOURS_TESTING=false
PREFERRED_EXIT_MODE=REGULAR        # REGULAR | GTT | AUTO
USE_SLM_EXIT=true
SL_LIMIT_OFFSET_TICKS=2

# =========================
# STRATEGY CORE (more active)
# =========================
MIN_SIGNAL_SCORE=2                 # was 3
CONFIDENCE_THRESHOLD=5.2           # was 5.8
BASE_STOP_LOSS_POINTS=20.0
BASE_TARGET_POINTS=40.0
ATR_PERIOD=14
ATR_SL_MULTIPLIER=1.5
ATR_TP_MULTIPLIER=3.0
SL_CONFIDENCE_ADJ=0.12
TP_CONFIDENCE_ADJ=0.35

# =========================
# MULTI-TIMEFRAME CONFIRMATION
# =========================
MTF_CONFIRM_ENABLE=true            # confirm 1m signal with higher TF
MTF_HIGHER_TF=5                    # minutes for the higher timeframe
MTF_BONUS=1                        # small score bonus when aligned

# =========================
# DATA / WARMUP
# =========================
WARMUP_BARS=25
DATA_LOOKBACK_MINUTES=45
HISTORICAL_TIMEFRAME=minute
SKIP_FIRST_MIN=5

# =========================
# INSTRUMENTS
# =========================
SPOT_SYMBOL=NSE:NIFTY 50
TRADE_SYMBOL=NIFTY
TRADE_EXCHANGE=NFO
INSTRUMENT_TOKEN=256265
NIFTY_LOT_SIZE=75
MIN_LOTS=1
MAX_LOTS=15
STRIKE_RANGE=3                     # ATM ±3 strikes

# =========================
# RISK / CIRCUIT BREAKERS
# =========================
RISK_PER_TRADE=0.025               # was 0.02 (more active)
MAX_DRAWDOWN=0.07
CONSECUTIVE_LOSS_LIMIT=3
MAX_DAILY_DRAWDOWN_PCT=0.05
CIRCUIT_RELEASE_PCT=0.015
HALT_ON_DRAWDOWN=true
MAX_CONCURRENT_POSITIONS=1
MAX_TRADES_PER_DAY=30
LOSS_COOLDOWN_MIN=2                # min pause after a loss close
MIN_REENTRY_COOLDOWN_SEC=30        # per-symbol cooldown after exit

# =========================
# OPTIONS BREAKOUT FILTERS (looser)
# =========================
OPTION_TYPE=BOTH
OPTION_SL_PERCENT=0.05
OPTION_TP_PERCENT=0.20
OPTION_BREAKOUT_PCT=0.003          # was 0.004
OPTION_SPOT_TREND_PCT=0.0025       # was 0.003
OPTION_REQUIRE_SPOT_CONFIRM=false  # allow option-led breakouts

# =========================
# EXECUTION / WORKERS
# =========================
DEFAULT_PRODUCT=MIS
DEFAULT_ORDER_TYPE=MARKET
DEFAULT_VALIDITY=DAY
TICK_SIZE=0.05
TRAILING_ENABLE=true
TRAIL_COOLDOWN_SEC=8               # was 10–12
WORKER_INTERVAL_SEC=4
NFO_FREEZE_QTY=1800

# =========================
# SPREAD / MICROSTRUCTURE GUARDRAILS
# =========================
SPREAD_GUARD_MODE=RANGE            # RANGE | LTP_MID
SPREAD_GUARD_BA_MAX=0.015
SPREAD_GUARD_LTPMID_MAX=0.015
SPREAD_GUARD_PCT=0.03

# Execution microstructure (smart entries)
EXEC_MODE=SMART                    # MARKET | SMART (marketable-limit when tight)
SPREAD_TICKS_FOR_MKTABLE=2         # use marketable-limit if spread ≤ this (in ticks)
IMBAL_ENABLE=true                  # use depth imbalance confirm
IMBAL_MIN=0.15                     # 15% imbalance threshold

# =========================
# ENTRY IMPROVEMENT (pullback & wait)
# =========================
ENTRY_WAIT_ENABLE=true
ENTRY_WAIT_SEC=3
ENTRY_PULLBACK_TICKS=1             # dip to EMA/VWAP by ≥1 tick then uptick

# =========================
# EVENT FILTER (block entries around major events)
# =========================
EVENT_BLOCK_LIST=                  # comma-separated ISO datetimes, e.g. 2025-08-20T11:30,2025-09-05T14:00
EVENT_BLOCK_WINDOW_MIN=5

# =========================
# FEES / SLIPPAGE
# =========================
SLIPPAGE_BPS=4.0
FEES_PER_LOT=25.0

# =========================
# PARTIAL TP / BREAKEVEN / TRAILING / HARD STOP
# =========================
PARTIAL_TP_ENABLE=true
PARTIAL_TP_RATIO=0.50              # 50% at TP1 (by lots)
PARTIAL_TP_USE_MIDPOINT=true
BREAKEVEN_AFTER_TP1_ENABLE=true
BREAKEVEN_OFFSET_TICKS=1
HARD_STOP_ENABLE=true
HARD_STOP_GRACE_SEC=3.0
HARD_STOP_SLIPPAGE_BPS=6
PARTIAL_TP2_R_MULT=2.0

# Trailing strategy
TRAIL_MODE=CHANDELIER              # ATR | CHANDELIER
CHAN_N=10
CHAN_K=2.5

# Profit lock ladder (ratchets after R multiples)
LOCK_R1=1.0                        # at +1R lock to:
LOCK_R2=2.0                        # at +2R lock to:
LOCK_TO=0.3,1.0                    # +0.3R at R1, +1.0R at R2

# Max hold time exit
MAX_HOLD_MIN=15
HOLD_EXIT_IF_R_BETWEEN=-0.2,0.6    # if within this R band at MAX_HOLD_MIN, exit

# =========================
# LOGGING
# =========================
LOG_FILE=logs/trades.csv
DIAGNOSTIC_VERBOSE=false
LOG_LEVEL=DEBUG
BALANCE_LOG_INTERVAL_MIN=30

# =========================
# HOURS (IST)
# =========================
USE_IST_CLOCK=true
TIME_FILTER_START=09:20
TIME_FILTER_END=15:20

# =========================
# STRIKE SELECTION WITH GREEKS (relaxed)
# =========================
USE_GREEKS_STRIKE_RANKING=true
TARGET_DELTA_CALL=0.35
TARGET_DELTA_PUT=-0.35
DELTA_TOL=0.07                     # was 0.05 → fewer fallbacks
REQUIRE_OI=false                   # relax for more candidates
MIN_OI=30000
RISK_FREE_RATE=0.06
IV_SOURCE=LTP_IMPLIED
EXPIRY_PREFERENCE=NEAR

# =========================
# ADAPTIVE SCHEDULING
# =========================
PEAK_POLL_SEC=12
OFFPEAK_POLL_SEC=25
PREFERRED_TIE_RULE=TREND