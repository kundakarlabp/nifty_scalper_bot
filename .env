9# --- Zerodha ---
ZERODHA_API_KEY=9a6h8ko5o1myv0hp
ZERODHA_API_SECRET=9yuor4cxqou1a9t3hkh4wsg1oz64hbsg
# Prefer this:
KITE_ACCESS_TOKEN=tw3q8PLdup1gfSDkTAWe5qzMD3b88mo3
# (legacy) If you still have old setups:
ZERODHA_ACCESS_TOKEN=tw3q8PLdup1gfSDkTAWe5qzMD3b88mo3

# --- Telegram ---
TELEGRAM_BOT_TOKEN=7962917167:AAGyIOqZJLq-TKz-ozZODcDT4syeVWFIybU
TELEGRAM_CHAT_ID=6931456598

# =========================
# MODES / TOGGLES
# =========================
ENABLE_LIVE_TRADING=true
ENABLE_TELEGRAM=true
ALLOW_OFFHOURS_TESTING=false
USE_IST_CLOCK=true
PREFERRED_EXIT_MODE=REGULAR          # AUTO | GTT | REGULAR

# =========================
# STRATEGY CORE
# =========================
MIN_SIGNAL_SCORE=2
CONFIDENCE_THRESHOLD=5.2
BASE_STOP_LOSS_POINTS=20.0
BASE_TARGET_POINTS=40.0
ATR_PERIOD=14
ATR_SL_MULTIPLIER=1.5
ATR_TP_MULTIPLIER=3.0
SL_CONFIDENCE_ADJ=0.12
TP_CONFIDENCE_ADJ=0.35

# Regime-aware behavior (new)
REGIME_TREND_TP_MULT=3.4
REGIME_TREND_SL_MULT=1.6
REGIME_RANGE_TP_MULT=2.4
REGIME_RANGE_SL_MULT=1.3
REGIME_MRV_ENABLE=true              # mean reversion in range mode
REGIME_MOM_ENABLE=true              # momentum continuation in trend mode

# Multi-timeframe confirmation (new)
HTF_TIMEFRAME_MIN=5
HTF_EMA_PERIOD=20
HTF_MIN_SLOPE=0.0                   # require slope > 0 for longs / < 0 for shorts

# Warmup / data
WARMUP_BARS=25
DATA_LOOKBACK_MINUTES=45
HISTORICAL_TIMEFRAME=minute
SKIP_FIRST_MIN=5

# =========================
# INSTRUMENTS / LOTS
# =========================
SPOT_SYMBOL=NSE:NIFTY 50
TRADE_SYMBOL=NIFTY
TRADE_EXCHANGE=NFO
INSTRUMENT_TOKEN=256265
NIFTY_LOT_SIZE=75
MIN_LOTS=1
MAX_LOTS=15
STRIKE_RANGE=3

# =========================
# RISK / CIRCUIT BREAKERS
# =========================
RISK_PER_TRADE=0.025
MAX_DRAWDOWN=0.07
CONSECUTIVE_LOSS_LIMIT=3
MAX_DAILY_DRAWDOWN_PCT=0.05
CIRCUIT_RELEASE_PCT=0.015
HALT_ON_DRAWDOWN=true
MAX_CONCURRENT_POSITIONS=1
MAX_TRADES_PER_DAY=30
LOSS_COOLDOWN_MIN=2

# Streak manager (new)
LOSS_STREAK_HALVE_SIZE=3            # on 3-loss streak, halve size next 3 trades
LOSS_STREAK_PAUSE_MIN=20            # or pause for N minutes

# Session R ladders (new; stop after strong up/down days)
DAY_STOP_AFTER_POS_R=4              # stop for the day after +4R
DAY_HALF_SIZE_AFTER_POS_R=2         # halve size after +2R
DAY_STOP_AFTER_NEG_R=-3             # stop after -3R

# Volatility-scaled risk (new)
ATR_TARGET=10.0                     # target ATR (pts) for 1x risk
ATR_MIN=3.0
VOL_RISK_CLAMP_MIN=0.5
VOL_RISK_CLAMP_MAX=1.5

# =========================
# OPTIONS FILTERS
# =========================
OPTION_TYPE=BOTH
OPTION_SL_PERCENT=0.05
OPTION_TP_PERCENT=0.20
OPTION_BREAKOUT_PCT=0.003
OPTION_SPOT_TREND_PCT=0.0025
OPTION_REQUIRE_SPOT_CONFIRM=false   # allow option-led breakouts

# Option microstructure (new)
MIN_PREMIUM=12.0                    # skip options priced below this
SPREAD_MEAN_PCT_MAX=0.03            # avg (high-low)/close limit over last N bars
IV_SOURCE=LTP_IMPLIED
RISK_FREE_RATE=0.06
IV_MAX=0.70                         # reject if IV exceeds this (0.70=70%)
EXPIRY_PREFERENCE=NEAR
REQUIRE_OI=false
MIN_OI=30000

# =========================
# EXECUTION / WORKERS
# =========================
DEFAULT_PRODUCT=MIS
DEFAULT_ORDER_TYPE=MARKET
DEFAULT_VALIDITY=DAY
TICK_SIZE=0.05
TRAILING_ENABLE=true
TRAIL_COOLDOWN_SEC=8
WORKER_INTERVAL_SEC=4
NFO_FREEZE_QTY=1800

# Pre-entry hygiene (new)
MAX_ENTRY_SLIP_BPS=25               # max 0.25% drift vs last close
ORDER_RETRY_LIMIT=2                 # retries for LIMIT entries
ORDER_RETRY_TICK_OFFSET=2           # widen limit by this many ticks per retry

# Adaptive spread guard (new)
SPREAD_GUARD_MODE=RANGE             # RANGE | LTP_MID
SPREAD_GUARD_BA_MAX=0.015
SPREAD_GUARD_LTPMID_MAX=0.015
SPREAD_GUARD_PCT=0.03
DYNAMIC_SPREAD_GUARD=true
SPREAD_VOL_LOOKBACK=20              # scale guard by recent realized vol

# =========================
# EXITS / PARTIALS
# =========================
PARTIAL_TP_ENABLE=true
PARTIAL_TP_RATIO=0.50
PARTIAL_TP_USE_MIDPOINT=true
PARTIAL_TP2_R_MULT=2.0

BREAKEVEN_AFTER_TP1_ENABLE=true
BREAKEVEN_OFFSET_TICKS=2

HARD_STOP_ENABLE=true
HARD_STOP_GRACE_SEC=3.0
HARD_STOP_SLIPPAGE_BPS=6

# Adaptive trailing (new)
CHANDELIER_N=22
CHANDELIER_K=2.5
VWAP_TRAIL_ENABLE=true

# Time-in-trade box exit (new)
MAX_HOLD_MIN=25
BOX_HOLD_PCT=0.01                   # exit if price stuck within ±1% of entry past MAX_HOLD_MIN

# =========================
# SCHEDULING / HOURS
# =========================
PEAK_POLL_SEC=12
OFFPEAK_POLL_SEC=25
TIME_FILTER_START=09:20
TIME_FILTER_END=15:20

# Optional time buckets (new)
ENABLE_TIME_BUCKETS=false
TIME_BUCKETS=09:30-11:15,13:45-15:00

# Known event windows – block entries (new; HH:MM-HH:MM comma-separated)
ENABLE_EVENT_WINDOWS=false
EVENT_WINDOWS=11:55-12:10,14:25-14:40

# =========================
# FEES / SLIPPAGE
# =========================
SLIPPAGE_BPS=4.0
FEES_PER_LOT=25.0

# =========================
# LOGGING / DIAGNOSTICS
# =========================
LOG_FILE=logs/trades.csv
DIAGNOSTIC_VERBOSE=false
LOG_LEVEL=DEBUG
BALANCE_LOG_INTERVAL_MIN=30
DETAIL_LOGS_ENABLE=true
HEARTBEAT_MIN=3

# =========================
# TELEGRAM
# =========================
TELEGRAM_BOT_TOKEN=
TELEGRAM_CHAT_ID=

# =========================
# ORDER SAFETY / STATE
# =========================
IDEMP_TTL_SEC=60                    # dedup window for entries
PERSIST_REATTACH_ON_START=true