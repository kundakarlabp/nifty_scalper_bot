{% extends "base.html" %}

{% block title %}Backtest Results - Nifty Scalper{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1><i class="bi bi-graph-down"></i> Backtest Results</h1>
        <p class="text-muted">Analyze strategy performance on historical data</p>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="bi bi-funnel"></i> Backtest Configuration</h5>
            </div>
            <div class="card-body">
                <form class="row g-3">
                    <div class="col-md-3">
                        <label for="startDate" class="form-label">Start Date</label>
                        <input type="date" class="form-control" id="startDate">
                    </div>
                    <div class="col-md-3">
                        <label for="endDate" class="form-label">End Date</label>
                        <input type="date" class="form-control" id="endDate">
                    </div>
                    <div class="col-md-2">
                        <label for="capital" class="form-label">Capital (₹)</label>
                        <input type="number" class="form-control" id="capital" value="100000">
                    </div>
                    <div class="col-md-2">
                        <label for="instrument" class="form-label">Instrument</label>
                        <select class="form-select" id="instrument">
                            <option selected>NIFTY 50</option>
                            <option>BANKNIFTY</option>
                            <option>FINNIFTY</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">&nbsp;</label>
                        <button type="button" class="btn btn-primary w-100"><i class="bi bi-play"></i> Run Backtest</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Performance Summary -->
    <div class="col-md-4 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="bi bi-bar-chart"></i> Performance Summary</h5>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush">
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        Total Trades
                        <span class="badge bg-primary rounded-pill">147</span>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        Win Rate
                        <span class="badge bg-success rounded-pill">68%</span>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        Total P&L
                        <span class="badge bg-info rounded-pill">₹47,500</span>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        Max Drawdown
                        <span class="badge bg-warning rounded-pill">3.2%</span>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        Sharpe Ratio
                        <span class="badge bg-success rounded-pill">1.9</span>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        Profit Factor
                        <span class="badge bg-info rounded-pill">2.3</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Equity Curve -->
    <div class="col-md-8 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="bi bi-graph-up"></i> Equity Curve</h5>
            </div>
            <div class="card-body">
                <canvas id="backtestChart" height="300"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- Trade Distribution -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="bi bi-pie-chart"></i> Trade Distribution</h5>
            </div>
            <div class="card-body">
                <canvas id="distributionChart" height="250"></canvas>
            </div>
        </div>
    </div>

    <!-- Recent Trades -->
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0"><i class="bi bi-table"></i> Sample Trades</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Symbol</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>2024-01-15</td>
                                <td>NIFTY 50</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Initialize charts
const backtestCtx = document.getElementById('backtestChart').getContext('2d');
const backtestChart = new Chart(backtestCtx, {
    type: 'line',
    data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
        datasets: [{
            label: 'Equity (₹)',
            data: [100000, 102500, 105200, 103800, 107500, 108200],
            borderColor: '#28a745',
            backgroundColor: 'rgba(40, 167, 69, 0.1)',
            borderWidth: 2,
            fill: true,
            tension: 0.1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: false,
                ticks: {
                    callback: function(value) {
                        return '₹' + value.toLocaleString();
                    }
                }
            }
        }
    }
});

const distributionCtx = document.getElementById('distributionChart').getContext('2d');
const distributionChart = new Chart(distributionCtx, {
    type: 'doughnut',
    data: {
        labels: ['Winning Trades', 'Losing Trades'],
        datasets: [{
            data: [68, 32],
            backgroundColor: ['#28a745', '#dc3545'],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom'
            }
        }
    }
});
</script>
{% endblock %}
